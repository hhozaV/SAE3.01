<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QCM</title>
</head>

<body>
    <h1>Question du QCM</h1>
    <p id="question"></p>
    <input type="checkbox" id="answer_a">
    <label for="answer_a" id="label_a"></label><br>

    <input type="checkbox" id="answer_b">
    <label for="answer_b" id="label_b"></label><br>

    <input type="checkbox" id="answer_c">
    <label for="answer_c" id="label_c"></label><br>

    <input type="checkbox" id="answer_d">
    <label for="answer_d" id="label_d"></label><br>

    <button id="easy" data-difficulty="easy">Question trop facile</button>
    <button id="validate">Valider</button>
    <button id="hard" data-difficulty="hard">Question trop difficile</button>

    <script>
        const questionElement = document.querySelector('#question');
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        const labels = document.querySelectorAll('label');

        const easyButton = document.querySelector('#easy');
        const validateButton = document.querySelector('#validate');
        const hardButton = document.querySelector('#hard');

        let theme = localStorage.getItem('selectedTheme');
        console.log('Selected Theme:', theme);

        let difficulty = 'Easy';

        easyButton.addEventListener('click', () => {
            if (difficulty === 'Easy') {
                // Impossible d'être plus facile donc pas de changement
            } else if (difficulty === 'Medium') {
                difficulty = 'Easy';
                updateDifficulty();
                fetchQuestion();
            } else if (difficulty === 'Hard') {
                difficulty = 'Medium';
                updateDifficulty();
                fetchQuestion();
            }
        });

        hardButton.addEventListener('click', () => {
            if (difficulty === 'Easy') {
                difficulty = 'Medium';
                updateDifficulty();
                fetchQuestion();
            } else if (difficulty === 'Medium') {
                difficulty = 'Hard';
                updateDifficulty();
                fetchQuestion();
            } else if (difficulty === 'Hard') {
                // Impossible d'être plus difficile donc pas de changement
            }
        });

        function updateDifficulty() {
            if (difficulty === 'Easy') {
                easyButton.disabled = true;
                hardButton.disabled = false;
            } else if (difficulty === 'Medium') {
                easyButton.disabled = false;
                hardButton.disabled = false;
            } else if (difficulty === 'Hard') {
                easyButton.disabled = false;
                hardButton.disabled = true;
            }
        }
        function fetchQuestion() {
            // Construction de l'url pour l'api, seulement la difficultée qui change dans l'url
            const apiUrl = "https://quizapi.io/api/v1/questions?apiKey=oEAYIMa1boNGNt83vjKFMfTR5bL5b7Tac9n2QwdR&category=" + theme + "&difficulty=" + difficulty + "&limit=1";

            fetch(apiUrl)
                .then(response => response.json())
                .then(decodedJson => {
                    console.log("API :", decodedJson);
                    const questionData = decodedJson[0];
                    displayQuestion(questionData);
                });
        }

        function displayQuestion(questionData) {
            questionElement.textContent = questionData.question;

            checkboxes.forEach((checkbox, index) => {
                const answerKey = `answer_${String.fromCharCode(97 + index)}`;
                const label = labels[index];

                if (questionData.answers[answerKey] !== null) {
                    checkbox.classList.remove('hidden');
                    label.textContent = questionData.answers[answerKey];
                } else {
                    checkbox.classList.add('hidden');
                }
            });

            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
        }
        fetchQuestion();
    </script>

</body>

</html>
